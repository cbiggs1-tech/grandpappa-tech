<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://www.googletagmanager.com https://www.google-analytics.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; media-src 'self'; connect-src 'self' https://www.google-analytics.com; font-src 'self';">
    <title>Begat - The Lineage Game</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V5C44LTNXZ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-V5C44LTNXZ');
    </script>
    <link rel="manifest" href="data:application/json,%7B%22name%22%3A%22Begat%22%2C%22short_name%22%3A%22Begat%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%231a1a2e%22%2C%22theme_color%22%3A%22%231a1a2e%22%2C%22icons%22%3A%5B%5D%7D">
    <link rel="stylesheet" href="begat.css">
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <h1 class="loading-title">BEGAT</h1>
        <p class="loading-text">Preparing the Lineage...</p>
    </div>

    <div class="start-screen" id="startScreen">
        <h1 class="start-title">BEGAT</h1>
        <p class="start-subtitle">The Lineage of Jesus</p>
        <button class="start-btn" id="startGameBtn">START GAME</button>
        <p class="start-level-info" id="startLevelInfo">Level 1: Patriarchs</p>
        <p class="start-time-limit" id="startTimeLimit">Time Limit: 3:00</p>
        <button class="start-music-btn" id="startMusicToggle">MUSIC: ON</button>
    </div>

    <div class="stars" id="stars"></div>

    <a href="../../games.html" class="home-btn" title="Back to Games" role="button" aria-label="Back to Games (Escape key)">ESC</a>

    <header class="header">
        <h1>BEGAT</h1>
        <p class="subtitle">The Lineage of Jesus</p>
        <div class="score-display">
            <span id="scoreDisplay">Score: 0</span>
            <span id="starsDisplay">Stars: 0</span>
        </div>
        <div class="timer-display" id="timerDisplay">‚è± 3:00</div>
    </header>

    <div class="level-indicator" id="levelIndicator">Level 1: Patriarchs</div>

    <main class="game-container">
        <div class="timeline-area" id="timelineArea">
            <div class="timeline-wrapper">
                <div class="time-scale" id="timeScale"></div>
                <div class="timeline" id="timeline"></div>
            </div>
        </div>
        <div class="card-pool-area">
            <p class="card-pool-label">Tap a card to unlock, then drag to timeline</p>
            <div class="card-pool" id="cardPool"></div>
        </div>
    </main>

    <button class="menu-btn" id="menuBtn" aria-label="Open menu" aria-haspopup="dialog">&#9776;</button>

    <div class="hint-display" id="hintDisplay"></div>

    <!-- Date Tooltip -->
    <div class="date-tooltip" id="dateTooltip">
        <span class="tooltip-date" id="tooltipDate"></span>
        <span class="tooltip-note">Approximate era based on biblical chronologies.</span>
    </div>

    <div class="modal-overlay" id="quizModal" role="dialog" aria-modal="true" aria-labelledby="quizHeader">
        <div class="quiz-modal">
            <div class="quiz-header">
                <h2>Unlock This Ancestor</h2>
            </div>
            <div class="quiz-description" id="quizDescription"></div>
            <p class="quiz-question">Who is this person?</p>
            <div class="quiz-options" id="quizOptions"></div>
            <p class="quiz-feedback" id="quizFeedback"></p>
        </div>
    </div>

    <div class="modal-overlay" id="menuModal" role="dialog" aria-modal="true" aria-labelledby="menuTitle">
        <div class="menu-modal">
            <h2 class="menu-title" id="menuTitle">Menu</h2>
            <div class="menu-options">
                <button class="menu-option" id="howToPlayBtn">How to Play</button>
                <button class="menu-option" id="newGameBtn">New Game</button>
                <button class="menu-option" id="levelSelectBtn">Select Level</button>
                <button class="menu-option" id="toggleSoundBtn">Sound: ON</button>
                <button class="menu-option" id="toggleSpeechBtn">Speech: OFF</button>
                <button class="menu-option" id="highContrastBtn">High Contrast</button>
                <button class="menu-option" id="colorblindBtn">Colorblind Mode</button>
                <button class="menu-option" id="closeMenuBtn">Close</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="levelModal">
        <div class="menu-modal">
            <h2 class="menu-title">Select Level</h2>
            <div class="menu-options" id="levelOptions"></div>
        </div>
    </div>

    <div class="modal-overlay" id="instructionsModal" role="dialog" aria-modal="true" aria-labelledby="instructionsTitle">
        <div class="menu-modal">
            <h2 class="menu-title" id="instructionsTitle">How to Play</h2>
            <div class="instructions-content">
                <p><strong>Goal:</strong> Place the ancestors of Jesus in chronological order on the timeline.</p>
                <ol>
                    <li><strong>Tap a locked card</strong> (marked with ?) to open a trivia quiz</li>
                    <li><strong>Answer correctly</strong> to unlock the card</li>
                    <li><strong>Drag the unlocked card</strong> to its correct position on the timeline</li>
                    <li><strong>Complete all placements</strong> before time runs out for bonus points</li>
                </ol>
                <p><strong>Controls:</strong></p>
                <ul>
                    <li><strong>Desktop:</strong> Click cards to quiz, drag to place</li>
                    <li><strong>Mobile:</strong> Tap to quiz, long-press and drag to place</li>
                    <li><strong>Keyboard:</strong> Tab to navigate, Enter to select, Escape to close</li>
                </ul>
                <p><strong>Accessibility:</strong></p>
                <ul>
                    <li><strong>Screen Readers:</strong> All cards and timeline slots announce names, positions, and dates</li>
                    <li><strong>Speech:</strong> Enable in Menu for spoken feedback on actions</li>
                    <li><strong>High Contrast:</strong> Enable in Menu for improved visibility</li>
                    <li><strong>Colorblind Mode:</strong> Enable in Menu for alternative color scheme</li>
                </ul>
            </div>
            <button class="menu-option" id="closeInstructionsBtn">Got it!</button>
        </div>
    </div>

    <div class="modal-overlay" id="winModal" role="dialog" aria-modal="true" aria-labelledby="winTitle">
        <div class="win-modal">
            <h2 class="win-title" id="winTitle">Behold the Lineage!</h2>
            <p class="win-subtitle">You've connected the generations from Abraham to Jesus!</p>
            <p class="win-score" id="finalScore">Final Score: 0</p>

            <!-- Name Entry for High Score -->
            <div class="name-entry" id="nameEntry">
                <label>New High Score! Enter your name:</label>
                <input type="text" id="playerNameInput" maxlength="12" placeholder="Your Name">
                <button id="saveScoreBtn">Save</button>
            </div>

            <!-- High Scores Display -->
            <div class="high-scores" id="highScoresSection">
                <h3>üèÜ Top Scores - Level <span id="highScoreLevel">1</span></h3>
                <ul class="high-scores-list" id="highScoresList">
                    <li><span class="rank">1.</span><span class="name">---</span><span class="score">0</span></li>
                    <li><span class="rank">2.</span><span class="name">---</span><span class="score">0</span></li>
                    <li><span class="rank">3.</span><span class="name">---</span><span class="score">0</span></li>
                </ul>
            </div>

            <div class="win-buttons">
                <button class="win-camera-btn" id="winCameraBtn" title="Take Screenshot">üì∑</button>
                <button class="win-btn" id="playAgainBtn">Play Again</button>
            </div>
        </div>
    </div>

    <div class="install-prompt" id="installPrompt">
        <p>Install Begat for offline play!</p>
        <button class="install-btn" id="installBtn">Install</button>
        <button class="dismiss-btn" id="dismissInstall">Not Now</button>
    </div>

    <!-- Background Music - Start Screen -->
    <audio id="startMusic" loop preload="none">
        <source src="../../music/Lineage.mp3" type="audio/mpeg">
    </audio>
    <!-- Background Music - Gameplay -->
    <audio id="gameMusic" loop preload="none">
        <source src="../../music/Ancestry.mp3" type="audio/mpeg">
    </audio>
    <button id="musicToggle" class="music-btn" aria-label="Toggle music" aria-pressed="true">MUSIC: ON</button>

    <!-- Share Button -->
    <button class="share-btn" id="shareBtn" title="Share Screenshot" aria-label="Share screenshot">&#128247;</button>

    <!-- Share Modal -->
    <div class="modal-overlay" id="shareModal">
        <div class="share-modal">
            <h2 class="share-title">Share Your Progress</h2>
            <img id="sharePreview" class="share-preview" alt="Screenshot preview" style="display:none;">
            <p id="shareStatus" class="share-status"></p>
            <div class="share-options">
                <button class="share-option" id="shareNativeBtn">&#128241; Share (Text/Apps)</button>
                <button class="share-option" id="shareEmailBtn">&#9993; Send via Email</button>
                <button class="share-option" id="downloadBtn">&#128190; Save Image</button>
                <button class="share-option" id="closeShareBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- html2canvas library for screenshots -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Game Logic -->
    <script type="module" src="js/begat.js"></script>
</body>
</html>
